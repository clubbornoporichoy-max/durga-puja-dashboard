<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Durga Puja Club Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  .list-item:hover { background-color: #f3f4f6; }
  .btn { transition: all 0.2s; }
  .btn:hover { opacity: 0.9; transform: translateY(-1px); }
  .truncate-details { max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .icon-btn { cursor: pointer; font-size: 1.1rem; padding: 2px 6px; border-radius: 4px; transition: 0.2s; }
  .icon-btn:hover { background-color: #e5e7eb; }
</style>
</head>
<body class="bg-gray-50 p-4 font-sans">
<header class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3">
  <h1 class="text-3xl font-bold">Durga Puja Club — Dashboard</h1>
  <div class="flex gap-2">
    <button onclick="exportCSV()" class="btn px-3 py-2 bg-indigo-600 text-white rounded-md shadow-sm">Export CSV</button>
    <button onclick="window.print()" class="btn px-3 py-2 bg-green-600 text-white rounded-md shadow-sm">Export PDF</button>
  </div>
</header>

<section class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 sticky top-0 z-10 bg-gray-50 p-4 rounded-lg shadow">
  <div class="text-center bg-yellow-50 p-4 rounded-lg shadow">
    <div class="text-sm text-gray-600">Total Income</div>
    <div class="text-xl font-semibold" id="totalIncome"></div>
  </div>
  <div class="text-center bg-yellow-50 p-4 rounded-lg shadow">
    <div class="text-sm text-gray-600">Total Expenses</div>
    <div class="text-xl font-semibold" id="totalExpenses"></div>
  </div>
  <div class="text-center bg-yellow-50 p-4 rounded-lg shadow">
    <div class="text-sm text-gray-600">Balance</div>
    <div class="text-xl font-semibold" id="balance"></div>
  </div>
</section>

<div class="grid lg:grid-cols-2 gap-6">
<main>
  <!-- Members -->
  <section class="bg-white p-4 rounded-lg shadow mb-6">
    <h2 class="text-lg font-semibold mb-3">Members Contribution</h2>
    <ul id="membersList" class="divide-y max-h-48 overflow-auto"></ul>
    <div class="flex gap-2 mt-3 flex-wrap">
      <input id="memberName" placeholder="Name" class="flex-1 px-3 py-2 border rounded-md" />
      <input id="memberAmount" placeholder="Amount" type="number" class="w-28 px-3 py-2 border rounded-md" />
      <button onclick="addMember()" class="btn px-3 py-2 bg-indigo-600 text-white rounded-md">Add</button>
    </div>
    <canvas id="membersChart" class="mt-4"></canvas>
  </section>

  <!-- Other Income -->
  <section class="bg-white p-4 rounded-lg shadow mb-6">
    <h2 class="text-lg font-semibold mb-3">Other Income (Advertisement, Donations, Sponsorship)</h2>
    <ul id="incomeList" class="divide-y max-h-48 overflow-auto"></ul>
    <div class="flex gap-2 mt-3 flex-wrap">
      <input id="incomeSource" placeholder="Source" class="px-3 py-2 border rounded-md flex-1" />
      <input id="incomeAmount" placeholder="Amount" type="number" class="w-28 px-3 py-2 border rounded-md" />
      <input id="incomeDetails" placeholder="Details" class="px-3 py-2 border rounded-md flex-1" />
      <button onclick="addIncome()" class="btn px-3 py-2 bg-indigo-600 text-white rounded-md">Add</button>
    </div>
    <canvas id="incomeChart" class="mt-4"></canvas>
  </section>

  <!-- Expenses -->
  <section class="bg-white p-4 rounded-lg shadow">
    <h2 class="text-lg font-semibold mb-3">Expenses</h2>
    <ul id="expensesList" class="divide-y max-h-48 overflow-auto"></ul>
    <div class="flex gap-2 mt-3 flex-wrap">
      <input id="expenseItem" placeholder="Item" class="px-3 py-2 border rounded-md flex-1" />
      <input id="expenseCost" placeholder="Cost" type="number" class="w-28 px-3 py-2 border rounded-md" />
      <input id="expenseDetails" placeholder="Details" class="px-3 py-2 border rounded-md flex-1" />
      <button onclick="addExpense()" class="btn px-3 py-2 bg-indigo-600 text-white rounded-md">Add</button>
    </div>
    <canvas id="expensesChart" class="mt-4"></canvas>
  </section>
</main>

<aside>
<section class="bg-white p-4 rounded-lg shadow mb-6">
  <h2 class="text-lg font-semibold mb-3">Income vs Expense Trend</h2>
  <canvas id="trendChart"></canvas>
</section>
<section class="bg-white p-4 rounded-lg shadow">
  <h3 class="font-semibold mb-2">Notes</h3>
  <p class="text-sm text-gray-600">Add members, other income or expenses with optional details. Use edit ✏️ and delete 🗑️ buttons for adjustments. Charts & totals update automatically. Data is saved in browser.</p>
</section>
</aside>
</div>

<script>
let members = JSON.parse(localStorage.getItem("members")) || [];
let otherIncome = JSON.parse(localStorage.getItem("otherIncome")) || [];
let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
let membersChart, incomeChart, expensesChart, trendChart;

function formatCurrency(n){return '₹'+n.toLocaleString();}
function saveData(){localStorage.setItem('members',JSON.stringify(members));localStorage.setItem('otherIncome',JSON.stringify(otherIncome));localStorage.setItem('expenses',JSON.stringify(expenses));}

function renderSummary(){
  const totalM = members.reduce((s,m)=>s+m.amount,0);
  const totalO = otherIncome.reduce((s,o)=>s+o.amount,0);
  const totalI = totalM+totalO;
  const totalE = expenses.reduce((s,e)=>s+e.cost,0);
  const bal = totalI - totalE;
  document.getElementById('totalIncome').innerText=formatCurrency(totalI);
  document.getElementById('totalExpenses').innerText=formatCurrency(totalE);
  document.getElementById('balance').innerText=formatCurrency(bal);
  document.getElementById('balance').className='text-xl font-semibold '+(bal>=0?'text-green-600':'text-red-600');
}

function renderLists(){
  document.getElementById('membersList').innerHTML = members.map((m,i)=>
    `<li class='py-2 flex justify-between items-center list-item'>
      <span>${m.name}</span>
      <span>${formatCurrency(m.amount)}</span>
      <div class='flex gap-2'>
        <span class='icon-btn text-blue-500' onclick='editMember(${i})'>✏️</span>
        <span class='icon-btn text-red-500' onclick='deleteMember(${i})'>🗑️</span>
      </div>
    </li>`).join('');

  document.getElementById('incomeList').innerHTML = otherIncome.map((o,i)=>
    `<li class='py-2 flex justify-between items-center list-item'>
      <div><div>${o.source}</div><div class='text-xs text-gray-500 truncate-details' title='${o.details||''}'>${o.details||''}</div></div>
      <span>${formatCurrency(o.amount)}</span>
      <div class='flex gap-2'>
        <span class='icon-btn text-blue-500' onclick='editIncome(${i})'>✏️</span>
        <span class='icon-btn text-red-500' onclick='deleteIncome(${i})'>🗑️</span>
      </div>
    </li>`).join('');

  document.getElementById('expensesList').innerHTML = expenses.map((e,i)=>
    `<li class='py-2 flex justify-between items-center list-item'>
      <div><div>${e.item}</div><div class='text-xs text-gray-500 truncate-details' title='${e.details||''}'>${e.details||''}</div></div>
      <span>${formatCurrency(e.cost)}</span>
      <div class='flex gap-2'>
        <span class='icon-btn text-blue-500' onclick='editExpense(${i})'>✏️</span>
        <span class='icon-btn text-red-500' onclick='deleteExpense(${i})'>🗑️</span>
      </div>
    </li>`).join('');
}

function deleteMember(i){members.splice(i,1);updateAll();}
function deleteIncome(i){otherIncome.splice(i,1);updateAll();}
function deleteExpense(i){expenses.splice(i,1);updateAll();}

function editMember(i){let n=prompt('Edit Name:',members[i].name);let a=prompt('Edit Amount:',members[i].amount);if(n&&!isNaN(a)){members[i]={name:n,amount:parseInt(a,10)};updateAll();}}
function editIncome(i){let s=prompt('Edit Source:',otherIncome[i].source);let a=prompt('Edit Amount:',otherIncome[i].amount);let d=prompt('Edit Details:',otherIncome[i].details||'');if(s&&!isNaN(a)){otherIncome[i]={source:s,amount:parseInt(a,10),details:d};updateAll();}}
function editExpense(i){let item=prompt('Edit Item:',expenses[i].item);let c=prompt('Edit Cost:',expenses[i].cost);let d=prompt('Edit Details:',expenses[i].details||'');if(item&&!isNaN(c)){expenses[i]={item,cost:parseInt(c,10),details:d};updateAll();}}

function updateAll(){renderSummary();renderLists();renderCharts();saveData();}

function addMember(){let n=document.getElementById('memberName').value.trim(),a=parseInt(document.getElementById('memberAmount').value,10);if(n&&a>0) members.push({name:n,amount:a});document.getElementById('memberName').value='';document.getElementById('memberAmount').value='';updateAll();}
function addIncome(){let s=document.getElementById('incomeSource').value.trim(),a=parseInt(document.getElementById('incomeAmount').value,10),d=document.getElementById('incomeDetails').value.trim();if(s&&a>0) otherIncome.push({source:s,amount:a,details:d});document.getElementById('incomeSource').value='';document.getElementById('incomeAmount').value='';document.getElementById('incomeDetails').value='';updateAll();}
function addExpense(){let i=document.getElementById('expenseItem').value.trim(),c=parseInt(document.getElementById('expenseCost').value,10),d=document.getElementById('expenseDetails').value.trim();if(i&&c>0) expenses.push({item:i,cost:c,details:d});document.getElementById('expenseItem').value='';document.getElementById('expenseCost').value='';document.getElementById('expenseDetails').value='';updateAll();}

function renderCharts(){
  if(membersChart) membersChart.destroy();
  membersChart=new Chart(document.getElementById('membersChart'),{type:'bar',data:{labels:members.map(m=>m.name),datasets:[{label:'Contribution',data:members.map(m=>m.amount),backgroundColor:'#0088FE'}]}});
  if(incomeChart) incomeChart.destroy();
  incomeChart=new Chart(document.getElementById('incomeChart'),{type:'pie',data:{labels:otherIncome.map(o=>o.source),datasets:[{data:otherIncome.map(o=>o.amount),backgroundColor:['#FF8042','#00C49F','#FFBB28','#0088FE']}]}});
  if(expensesChart) expensesChart.destroy();
  expensesChart=new Chart(document.getElementById('expensesChart'),{type:'pie',data:{labels:expenses.map(e=>e.item),datasets:[{data:expenses.map(e=>e.cost),backgroundColor:['#A020F0','#FF4444','#00C49F','#0088FE']}]}});
  if(trendChart) trendChart.destroy();
  let cumI=0,cumE=0,data=[];
  for(let j=0;j<Math.max(members.length,otherIncome.length,expenses.length);j++){if(members[j]) cumI+=members[j].amount;if(otherIncome[j]) cumI+=otherIncome[j].amount;if(expenses[j]) cumE+=expenses[j].cost;data.push({x:`Entry ${j+1}`,income:cumI,expense:cumE});}
  trendChart=new Chart(document.getElementById('trendChart'),{type:'line',data:{labels:data.map(d=>d.x),datasets:[{label:'Income',data:data.map(d=>d.income),borderColor:'#0088FE',fill:false},{label:'Expense',data:data.map(d=>d.expense),borderColor:'#FF4444',fill:false}]}});
}

function exportCSV(){
  let csv='Section,Name/Item,Amount,Details\n';
  members.forEach(m=>{csv+=`Member Contribution,${m.name},${m.amount},\n`;});
  otherIncome.forEach(o=>{csv+=`Other Income,${o.source},${o.amount},${o.details||''}\n`;});
  expenses.forEach(e=>{csv+=`Expense,${e.item},${e.cost},${e.details||''}\n`;});
  const totalM = members.reduce((s,m)=>s+m.amount,0);
  const totalO = otherIncome.reduce((s,o)=>s+o.amount,0);
  const totalI = totalM+totalO;
  const totalE = expenses.reduce((s,e)=>s+e.cost,0);
  csv+=`Summary,Total Income,${totalI},\n`;csv+=`Summary,Total Expense,${totalE},\n`;csv+=`Summary,Balance,${totalI-totalE},\n`;
  const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download='durga_puja_dashboard.csv';a.click();URL.revokeObjectURL(url);
}

updateAll();
</script>
</body>
</html>
