<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Club Dashboard</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; background: #f5f5f5; }
    h2 { text-align: center; }
    .list-item { display: flex; justify-content: space-between; background: white; padding: 8px; margin: 4px 0; border-radius: 6px; }
    .edit-btn, .delete-btn { margin-left: 5px; cursor: pointer; }
    .hidden { display: none; }
    #edit-modal { 
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center;
    }
    #edit-box { background: white; padding: 15px; border-radius: 10px; width: 90%; max-width: 400px; }
    #edit-box input, #edit-box textarea, #edit-box select { width: 100%; margin: 5px 0; padding: 6px; }
    .btn-row { display: flex; justify-content: space-between; margin-top: 10px; }
    .btn-row button { flex: 1; margin: 0 4px; padding: 8px; }

    /* ‚úÖ Toast styling */
    #toast {
      visibility: hidden;
      min-width: 250px;
      margin-left: -125px;
      background-color: #323232;
      color: #fff;
      text-align: center;
      border-radius: 8px;
      padding: 12px;
      position: fixed;
      z-index: 1000;
      left: 50%;
      bottom: 30px;
      font-size: 16px;
      opacity: 0;
      transition: opacity 0.5s ease, bottom 0.5s ease;
    }
    #toast.show {
      visibility: visible;
      opacity: 1;
      bottom: 50px;
    }
  </style>
</head>
<body>
  <h2>Club Dashboard</h2>

  <h3>Members</h3>
  <div id="members-list"></div>

  <h3>Income</h3>
  <div id="income-list"></div>

  <h3>Expenses</h3>
  <div id="expenses-list"></div>

  <!-- Edit Modal -->
  <div id="edit-modal" class="hidden">
    <div id="edit-box">
      <h3 id="edit-title">Edit Entry</h3>
      <input type="text" id="edit-field1">
      <input type="number" id="edit-field2">
      <textarea id="edit-details" placeholder="Details"></textarea>
      <select id="edit-category"></select>
      <select id="edit-recurring">
        <option value="none">No Recurrence</option>
        <option value="weekly">Weekly</option>
        <option value="monthly">Monthly</option>
      </select>
      <div class="btn-row">
        <button id="save-edit">üíæ Save</button>
        <button id="cancel-edit">‚ùå Cancel</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Toast notification -->
  <div id="toast"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getFirestore, collection, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

  // ‚úÖ FULL FIREBASE CONFIG
  const firebaseConfig = {
    apiKey: "AIzaSyCuVs6jx7HiNIx25lzLgoq1B6nQqaHLHm0",
    authDomain: "guestandcollection.firebaseapp.com",
    projectId: "guestandcollection",
    storageBucket: "guestandcollection.firebasestorage.app",
    messagingSenderId: "272174514290",
    appId: "1:272174514290:web:adf0f99bafccab70b6db0e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const membersList = document.getElementById("members-list");
  const incomeList = document.getElementById("income-list");
  const expensesList = document.getElementById("expenses-list");
  const toast = document.getElementById("toast");

  // Modal elements
  const editModal = document.getElementById("edit-modal");
  const editField1 = document.getElementById("edit-field1");
  const editField2 = document.getElementById("edit-field2");
  const editDetails = document.getElementById("edit-details");
  const editCategory = document.getElementById("edit-category");
  const editRecurring = document.getElementById("edit-recurring");
  const editTitle = document.getElementById("edit-title");
  const saveEditBtn = document.getElementById("save-edit");
  const cancelEditBtn = document.getElementById("cancel-edit");

  let currentDoc = null;
  let currentType = null;

  function showToast(message) {
    toast.textContent = message;
    toast.className = "show";
    setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 2500);
  }

  function createListItem(docSnap, type) {
    const data = docSnap.data();
    const div = document.createElement("div");
    div.className = "list-item";

    let label = "";
    if (type === "member") label = `${data.name} - ‚Çπ${data.amount}`;
    if (type === "income") label = `${data.source} - ‚Çπ${data.amount}`;
    if (type === "expense") label = `${data.item} - ‚Çπ${data.cost}`;

    const span = document.createElement("span");
    span.textContent = label;

    const edit = document.createElement("button");
    edit.textContent = "‚úèÔ∏è";
    edit.className = "edit-btn";
    edit.onclick = () => openEditModal(docSnap, type, data);

    const del = document.createElement("button");
    del.textContent = "üóëÔ∏è";
    del.className = "delete-btn";
    del.onclick = async () => {
      if (confirm("Delete this entry?")) {
        await deleteDoc(docSnap.ref);
        showToast("üóëÔ∏è Deleted successfully!");
      }
    };

    div.appendChild(span);
    div.appendChild(edit);
    div.appendChild(del);
    return div;
  }

  function openEditModal(docSnap, type, data) {
    currentDoc = docSnap;
    currentType = type;

    editTitle.textContent = `Edit ${type}`;
    if (type === "member") {
      editField1.placeholder = "Name";
      editField1.value = data.name;
      editField2.placeholder = "Amount";
      editField2.value = data.amount;
      editCategory.innerHTML = "";
      editCategory.style.display = "none";
    } else if (type === "income") {
      editField1.placeholder = "Source";
      editField1.value = data.source;
      editField2.placeholder = "Amount";
      editField2.value = data.amount;
      editCategory.style.display = "block";
      editCategory.innerHTML = `
        <option value="General">General</option>
        <option value="Donation">Donation</option>
        <option value="Sponsorship">Sponsorship</option>
      `;
      editCategory.value = data.category || "General";
    } else {
      editField1.placeholder = "Item";
      editField1.value = data.item;
      editField2.placeholder = "Cost";
      editField2.value = data.cost;
      editCategory.style.display = "block";
      editCategory.innerHTML = `
        <option value="General">General</option>
        <option value="Food">Food</option>
        <option value="Decoration">Decoration</option>
      `;
      editCategory.value = data.category || "General";
    }

    editDetails.value = data.details || "";
    editRecurring.value = data.recurring || "none";
    editModal.classList.remove("hidden");
  }

  cancelEditBtn.onclick = () => editModal.classList.add("hidden");

  saveEditBtn.onclick = async () => {
    const updatedData = {};
    if (currentType === "member") {
      updatedData.name = editField1.value;
      updatedData.amount = parseInt(editField2.value);
    } else if (currentType === "income") {
      updatedData.source = editField1.value;
      updatedData.amount = parseInt(editField2.value);
      updatedData.category = editCategory.value;
    } else {
      updatedData.item = editField1.value;
      updatedData.cost = parseInt(editField2.value);
      updatedData.category = editCategory.value;
    }
    updatedData.details = editDetails.value;
    updatedData.recurring = editRecurring.value;

    await updateDoc(currentDoc.ref, updatedData);
    editModal.classList.add("hidden");
    showToast("‚úÖ Updated successfully!");
  };

  // Realtime listeners
  onSnapshot(collection(db, "members"), snap => {
    membersList.innerHTML = "";
    snap.forEach(docSnap => membersList.appendChild(createListItem(docSnap, "member")));
  });

  onSnapshot(collection(db, "otherIncome"), snap => {
    incomeList.innerHTML = "";
    snap.forEach(docSnap => incomeList.appendChild(createListItem(docSnap, "income")));
  });

  onSnapshot(collection(db, "expenses"), snap => {
    expensesList.innerHTML = "";
    snap.forEach(docSnap => expensesList.appendChild(createListItem(docSnap, "expense")));
  });

</script>
</body>
</html>
