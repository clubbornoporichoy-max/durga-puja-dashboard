<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Durga Puja Dashboard</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: 'Poppins', sans-serif; margin: 0; background: #F7F7F7; }
header { background: linear-gradient(90deg, #FF6F61, #FFD166); padding: 20px; text-align: center; color: white; }
header h1 { margin: 0; font-size: 2rem; }
.container { max-width: 1200px; margin: auto; padding: 20px; }
section.card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 6px 15px rgba(0,0,0,0.08); }
h2 { margin-bottom: 10px; }
ul { list-style: none; padding: 0; max-height: 200px; overflow-y: auto; margin-bottom: 10px; }
li { display: flex; justify-content: space-between; padding: 8px 5px; border-bottom: 1px solid #eee; align-items: center; gap: 8px; }
input { padding: 6px 8px; margin: 3px; border-radius: 6px; border: 1px solid #ccc; }
button { padding: 6px 10px; border-radius: 6px; border: none; cursor: pointer; margin-left: 3px; }
.add-btn { background: #06D6A0; color: white; }
.edit-btn { background: orange; color: white; }
.delete-btn { background: red; color: white; }
.chart-container { width: 100%; height: 250px; margin-top: 10px; }
.hidden { display: none; }
.flex-row { display: flex; gap: 20px; flex-wrap: wrap; }
.flex-row > section { flex: 1 1 calc(50% - 20px); }
.summary-mini { display:flex; justify-content: space-between; padding:10px; border-radius:8px; background:#FFEBCD; margin-bottom:10px; font-weight:600;}
</style>
</head>
<body>

<header>
  <h1>ðŸŽ‰ Durga Puja Club Dashboard ðŸŽ‰</h1>
</header>

<div class="container">

  <!-- Login -->
  <div id="login-section">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="login-btn">Login</button>
    <p id="login-error" style="color:red;"></p>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden">

    <div class="flex-row">
      <section class="card">
        <h2>Summary</h2>
        <div class="summary-mini">Total Income: â‚¹<span id="total-income">0</span></div>
        <div class="summary-mini">Total Expenses: â‚¹<span id="total-expense">0</span></div>
        <div class="summary-mini">Balance: â‚¹<span id="balance">0</span></div>
      </section>

      <section class="card">
        <h2>Income vs Expense Trend</h2>
        <canvas id="trend-chart"></canvas>
      </section>
    </div>

    <div class="flex-row">
      <!-- Members -->
      <section class="card">
        <h2>Members Contribution</h2>
        <ul id="members-list"></ul>
        <div>
          <input type="text" id="member-name" placeholder="Name">
          <input type="number" id="member-amount" placeholder="Amount">
          <button class="add-btn" id="add-member">âž• Add</button>
        </div>
        <div class="chart-container">
          <canvas id="members-chart"></canvas>
        </div>
      </section>

      <!-- Other Income -->
      <section class="card">
        <h2>Other Income</h2>
        <ul id="income-list"></ul>
        <div>
          <input type="text" id="income-source" placeholder="Source">
          <input type="number" id="income-amount" placeholder="Amount">
          <input type="text" id="income-details" placeholder="Details">
          <button class="add-btn" id="add-income">âž• Add</button>
        </div>
        <div class="chart-container">
          <canvas id="income-chart"></canvas>
        </div>
      </section>

      <!-- Expenses -->
      <section class="card">
        <h2>Expenses</h2>
        <ul id="expense-list"></ul>
        <div>
          <input type="text" id="expense-item" placeholder="Item">
          <input type="number" id="expense-cost" placeholder="Cost">
          <input type="text" id="expense-details" placeholder="Details">
          <button class="add-btn" id="add-expense">âž• Add</button>
        </div>
        <div class="chart-container">
          <canvas id="expense-chart"></canvas>
        </div>
      </section>
    </div>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDO56RHOZ9rGHFo6a4O2hcYw9JLxVdfBwQ",
  authDomain: "create-3b0f7.firebaseapp.com",
  projectId: "create-3b0f7",
  storageBucket: "create-3b0f7.firebasestorage.app",
  messagingSenderId: "222954978623",
  appId: "1:222954978623:web:fb52decc4380934998278a",
  measurementId: "G-TZZ0KCEB1Z"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const YOUR_UID = "6tm3ARsrMwPsyhV5DOqQG3ZqlHv1";

const loginSection=document.getElementById('login-section');
const dashboard=document.getElementById('dashboard');
const loginBtn=document.getElementById('login-btn');
const loginError=document.getElementById('login-error');

const membersList=document.getElementById('members-list');
const incomeList=document.getElementById('income-list');
const expenseList=document.getElementById('expense-list');

const memberName=document.getElementById('member-name');
const memberAmount=document.getElementById('member-amount');
const addMemberBtn=document.getElementById('add-member');

const incomeSource=document.getElementById('income-source');
const incomeAmount=document.getElementById('income-amount');
const incomeDetails=document.getElementById('income-details');
const addIncomeBtn=document.getElementById('add-income');

const expenseItem=document.getElementById('expense-item');
const expenseCost=document.getElementById('expense-cost');
const expenseDetails=document.getElementById('expense-details');
const addExpenseBtn=document.getElementById('add-expense');

const totalIncomeEl=document.getElementById('total-income');
const totalExpenseEl=document.getElementById('total-expense');
const balanceEl=document.getElementById('balance');

let currentUser=null;
let membersChart,incomeChart,expenseChart,trendChart;

// Login
loginBtn.addEventListener('click', async ()=>{
  try{
    const email=document.getElementById('email').value;
    const password=document.getElementById('password').value;
    const userCredential=await auth.signInWithEmailAndPassword(email,password);
    currentUser=userCredential.user;
    loginSection.classList.add('hidden');
    dashboard.classList.remove('hidden');
    initDashboard();
  }catch(e){loginError.textContent=e.message;}
});

// Dashboard
function initDashboard(){
  function randomColor(i){const c=["#FF6F61","#FFD166","#06D6A0","#4D96FF","#FF6FFF","#FFA500"];return c[i%c.length];}

  // Render Members
  db.collection('members').orderBy('createdAt').onSnapshot(snap=>{
    membersList.innerHTML=''; let labels=[],data=[];
    snap.forEach(doc=>{
      const d=doc.data(); labels.push(d.name); data.push(d.amount);
      const li=document.createElement('li'); li.textContent=`${d.name} - â‚¹${d.amount}`;
      if(currentUser.uid===YOUR_UID){
        const edit=document.createElement('button'); edit.textContent='âœ'; edit.className='edit-btn';
        edit.onclick=()=>{
          const newAmount=prompt("Edit Amount:",d.amount);
          if(newAmount) db.collection('members').doc(doc.id).update({amount:parseInt(newAmount)});
        };
        const del=document.createElement('button'); del.textContent='ðŸ—‘'; del.className='delete-btn';
        del.onclick=()=>db.collection('members').doc(doc.id).delete();
        li.appendChild(edit); li.appendChild(del);
      }
      membersList.appendChild(li);
    });
    if(membersChart) membersChart.destroy();
    membersChart=new Chart(document.getElementById('members-chart'),{type:'bar',data:{labels,datasets:[{label:'Amount',data,backgroundColor:labels.map((_,i)=>randomColor(i))}]},options:{responsive:true}});
    updateSummary();
  });

  // Render Other Income
  db.collection('otherIncome').orderBy('createdAt').onSnapshot(snap=>{
    incomeList.innerHTML=''; let labels=[],data=[];
    snap.forEach(doc=>{
      const d=doc.data(); labels.push(d.source); data.push(d.amount);
      const li=document.createElement('li'); li.textContent=`${d.source} - â‚¹${d.amount} (${d.details||''})`;
      if(currentUser.uid===YOUR_UID){
        const edit=document.createElement('button'); edit.textContent='âœ'; edit.className='edit-btn';
        edit.onclick=()=>{
          const newSource=prompt("Edit Source:",d.source);
          const newAmount=prompt("Edit Amount:",d.amount);
          const newDetails=prompt("Edit Details:",d.details||"");
          if(newSource && newAmount) db.collection('otherIncome').doc(doc.id).update({source:newSource,amount:parseInt(newAmount),details:newDetails});
        };
        const del=document.createElement('button'); del.textContent='ðŸ—‘'; del.className='delete-btn';
        del.onclick=()=>db.collection('otherIncome').doc(doc.id).delete();
        li.appendChild(edit); li.appendChild(del);
      }
      incomeList.appendChild(li);
    });
    if(incomeChart) incomeChart.destroy();
    incomeChart=new Chart(document.getElementById('income-chart'),{type:'bar',data:{labels,datasets:[{label:'Amount',data,backgroundColor:labels.map((_,i)=>randomColor(i))}]},options:{responsive:true}});
    updateSummary();
  });

  // Render Expenses
  db.collection('expenses').orderBy('createdAt').onSnapshot(snap=>{
    expenseList.innerHTML=''; let labels=[],data=[];
    snap.forEach(doc=>{
      const d=doc.data(); labels.push(d.item); data.push(d.cost);
      const li=document.createElement('li'); li.textContent=`${d.item} - â‚¹${d.cost} (${d.details||''})`;
      if(currentUser.uid===YOUR_UID){
        const edit=document.createElement('button'); edit.textContent='âœ'; edit.className='edit-btn';
        edit.onclick=()=>{
          const newItem=prompt("Edit Item:",d.item);
          const newCost=prompt("Edit Cost:",d.cost);
          const newDetails=prompt("Edit Details:",d.details||"");
          if(newItem && newCost) db.collection('expenses').doc(doc.id).update({item:newItem,cost:parseInt(newCost),details:newDetails});
        };
        const del=document.createElement('button'); del.textContent='ðŸ—‘'; del.className='delete-btn';
        del.onclick=()=>db.collection('expenses').doc(doc.id).delete();
        li.appendChild(edit); li.appendChild(del);
      }
      expenseList.appendChild(li);
    });
    if(expenseChart) expenseChart.destroy();
    expenseChart=new Chart(document.getElementById('expense-chart'),{type:'bar',data:{labels,datasets:[{label:'Cost',data,backgroundColor:labels.map((_,i)=>randomColor(i))}]},options:{responsive:true}});
    updateSummary();
  });
}

// Add entries
addMemberBtn.onclick=()=>{if(currentUser.uid===YOUR_UID&&memberName.value&&memberAmount.value){db.collection('members').add({name:memberName.value,amount:parseInt(memberAmount.value),createdAt:firebase.firestore.FieldValue.serverTimestamp()});memberName.value='';memberAmount.value='';}};
addIncomeBtn.onclick=()=>{if(currentUser.uid===YOUR_UID&&incomeSource.value&&incomeAmount.value){db.collection('otherIncome').add({source:incomeSource.value,amount:parseInt(incomeAmount.value),details:incomeDetails.value,createdAt:firebase.firestore.FieldValue.serverTimestamp()});incomeSource.value='';incomeAmount.value='';incomeDetails.value='';}};
addExpenseBtn.onclick=()=>{if(currentUser.uid===YOUR_UID&&expenseItem.value&&expenseCost.value){db.collection('expenses').add({item:expenseItem.value,cost:parseInt(expenseCost.value),details:expenseDetails.value,createdAt:firebase.firestore.FieldValue.serverTimestamp()});expenseItem.value='';expenseCost.value='';expenseDetails.value='';}};

// Summary + Trend
async function updateSummary(){
  const mem=await db.collection('members').get();
  const inc=await db.collection('otherIncome').get();
  const exp=await db.collection('expenses').get();
  let totalIncome=0,totalExpense=0;
  mem.forEach(d=>totalIncome+=d.data().amount);
  inc.forEach(d=>totalIncome+=d.data().amount);
  exp.forEach(d=>totalExpense+=d.data().cost);
  totalIncomeEl.textContent=totalIncome;
  totalExpenseEl.textContent=totalExpense;
  balanceEl.textContent=totalIncome-totalExpense;
  if(trendChart) trendChart.destroy();
  trendChart=new Chart(document.getElementById('trend-chart'),{type:'line',data:{labels:['Income','Expenses'],datasets:[{label:'Income',data:[totalIncome],borderColor:'#06D6A0',tension:0.4},{label:'Expenses',data:[totalExpense],borderColor:'#FF6F61',tension:0.4}]},options:{responsive:true}});
}
</script>

</body>
</html>
